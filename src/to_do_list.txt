Change Log
----------
v1.2.0  - Modifications on the algorithm to set boiler & heater icons (mqttClient.cpp and index_script.js)
v1.1.5  - Added more reasons to fail when JSON parsing MQTT messages (mqttClient.cpp)
        - Troubleshooting
          * ISS020 - minMaxHeapBlockSizeSinceUpgrade is not updated after the firmware upgrade
v1.1.4  - Preventive reset in case of MQTT payload JSON parsing errors exceeds JSON_ERRORS_LIMIT_THERSHOLD limit in JSON_ERRORS_GAP_THERSHOLD milliseconds
          + maintenance.html, maintenance_script.js and styles.css modifyed accordingly
        - Boiler and Heater timers are saved in EEPROM before every ESP.restart();
v1.1.3  - Not serve web pages if heapSize, heapBlockSize are below thresholds
        - Automatic web server availability check after rebooting
        - Troubleshooting
          + ISS018: webLogsOn and sysLogsOn are always OFF (false) when the WiFi is recoverd after losing connectivity 
          + ISS019: web server test done when uploading binary makes the upload process to fail
            * v1.1.3 - Added lastTimeWebPageServed variable to track how long ago a web page was served. If recently, no need for connectivity checks
v1.1.2  - Added syslog configuration in web page and syslong switch button in mqtt
          + Added new variables to samples: debugModeOn, serialLogsOn, webLogsOn, sysLogsOn, sysLogServer, sysLogServerUDPPort
        - Web forms based on json variable readings 
        - Troubleshooting
          + ISS019
            * v1.1.2 - Actions in the main loop are ignored if webserver is serving content (webServerResponding flag) to avoid risking heap leakage
            * v1.1.2 - avoid serving web pages if other heavy processes are ongoing (mqtt publishing, send http updates) (new blockWebServer variable)
              + Increase Task Watchdog Timeout to ESP_TASK_WDT_TIMEOUT - esp_task_wdt_init(ESP_TASK_WDT_TIMEOUT, true);
        - Enriche logs to track heap size
        - Track mqtt publish activity
          + change forceMQTTpublish from bool to uint8_t to track the reasons to publish mqtt messages
        - printLogs with heap memory in webServer funcions
        - Optimize HTTP_POST code
          + In webserver, http_post, change if ()..., if()..., if ()... by if ()..., else if()..., else if ()...
        - Checks heap size in webServer.cpp
        - Heap check done in mqttClientPublishHADiscovery() rather than in mqtt_publish_samples()
          + Check based on esp_get_free_heap_size() instead of heap_caps_get_largest_free_block(MALLOC_CAP_8BIT)
v1.1.1  - Dynamic mqtt icon for boiler and radiator in index.html. Icon change based on boilerOn or thermostateOn variables (flame on/off)
        - Heap size optimization:
          + mqtt buffers converted into global variables: bufferTopicHAName, bufferPayload, bufferMqttTopicName, bufferDeviceSufix, bufferIpAddress, bufferDevice,
             bufferMqttSensorTopicHAPrefixName,  bufferMqttBinarySensorTopicHAPrefixName,  bufferMqttSwitchTopicHAPrefixName,  bufferMqttButtonTopicHAPrefixName
        - Added syslog support
v1.1.0  - New approach based on updating html id tags with javascript for serving dynamic web content
          + graphs and container still with ~ processing
        - New boiler icon if it's burning gas (boilerOn or thermostateOn)
v1.0.0  - First stable complete version
        - New line for "Power Thresh. (W):" in cloud.html
        - New icons for HA:
          + counter = mdi:counter
          + ip      = mdi:ip-network
          + upTime  = mdi:clock-end
          Troubleshooting:
           + IS0018: Not MQTT subscription to Energy topic (SmartPlug) after enabling it in cloud.html   
v0.9.B  - JSON samples variable redefined to avoid unnecessary String values
        - New strategy to create the mqtt HADiscovery message payload different than String to reduce heap consumption
        - Defined number of float decimales in value_template field of the MQTT messages (temperature, gas, etc.)
        - Reading samples (and sending MQTT and web SSE events) every:
          + SAMPLE_PERIOD (20 sg) if gas burning (either warming water or heater) or !gasClear
          + SAMPLE_PERIOD (300 sg) if no gas burning and gasClear
          + Both MQTT messages and web SSE Events are sent upon receiving MQTT messages from the SmartPlug, regardles the SAMPLE_PERIOD value
        - Send httpCloud update at boot time to clean up the iot file
        - Delay sending the first HA Discovery message to avoid risking heap leakage
        - Set Power Threshold from web
        - Troubleshooting
          + IS0014: boilerOnToday and boilerOnYesterday not saved correctly in EEPROM when changing day
            * boilerOnYesterday=0, boilerOnToday=88 => change day => boilerOnYesterday=88, boilerOnToday=0 => Reboot ==> boilerOnYesterday=0, boilerOnToday=198
          + IS0015: boiler and heater Time On Mounth counters not reset
          + IS0016: Some objects in the HA Discovery message are not recognized by HA in the very first packet sent after booting up
v0.9.A  - Color grey Web boiler icon and Energy info if not powerMeasureEnabled
        - Set N/A or N/E to the values related to SmartPlug if powerMeasureEnabled is disabled from web
        - Troubleshooting
          + ISS010: Time On Today counter not saved in Yesterday when passing to the next day
          + ISS011: No subscripion on MQTT power Topic after enabling MQTT Power Measurements in web
v0.9.9  - Remove year from the MQTT topic for both previous and current years
        - Added support for MQTT Power Topic subscription
        - Added boiler activity info (on and burning gas) in the index web page
v0.9.8  - Added Stats web page
v0.9.7  - Added Dasboard web page
          + Web Event for sample update
          + Web Socket for toogle the Relay switches
v0.9.6  - Error counters save in EEPROM
        - Added button to reset counters
        - Added specific counter for resets due to web server failing
v0.9.5  - New variables for:
          + Min heap size seen since last boot
          + debugModeOn => Global logs ON/OFF
          + serialLogsOn => Serial logs ON/OFF
          + webLogsOn => Web logs ON/OFF
          + Web configuration/visualization support
        - Check connectivity and webserver and restart if needed
        - Forcing to free up heap memory in the event it's below a thresholds
          + Switch WiFi OFF/ON, WebServer OFF/ON, etc.
v0.9.4  - Minor bug fixing
v0.9.3  - Bug fixing ISS001
v0.9.2  - Init NTP-dependant modules after NTP initialization during normal execution:
          + EEPROM Time counters
        - Init wifi-dependant modules after wifi initialization during normal execution:
          + NTP, WebServer, WebSocket, MQTT, Upload server
v0.9.1  - WebSerial for log webconsole
        - OTA support
        - Web logs support
        - Time counters saved in EEPPROM
v0.9.0  - MQTT improvements
	        + Time on counters: year, moths, yesterday, today
v0.8.9  - First stable version with HA support


To do list for boiler relay control
-----------------------------------
- New variable to track the time the flame is on (boilerFlameTimeOnPreviousYear boilerFlameTimeOnYear heaterFlameTimeOnPreviousYear heaterFlameTimeOnYear
- Avoid uploading files if MQTT messares are being received (either boiler or thermostat are active)
- Troubleshooting:

- Get and Show Smart Plug's IP address in web page with link to it
- Get Energy values on gas_sample periods at boot time to update the index web page accordingly

Done
--------
- detect thermostate on/off
- relay controls Rl1 and Rl2
- MQTT
- Send notification if gas leaks detected
- Update pandora with Thermostat activity
- Prevent from activating Relays in gas leak situation
- Error counters
  + WiFi connections
  + HTTP Cloud sample update
  + NTP sync
  + MQTT update
  + Uncontrolled resets
- MQTT Sensor
  + Boot count since last firmware update
  + Uncontrolled reset count
  + Other error counters
- Save in EEPROM durations of boiler burnings: today, yesterday, month, year
- Init NTP-dependant modules after NTP initialization during normal execution:
  + EEPROM Time counters
- Init wifi-dependant modules after wifi initialization during normal execution:
  + NTP, WebServer, WebSocket, MQTT, Upload server
- Variables for:
  + Min heap size seen since last boot
  + debugModeOn => Global logs ON/OFF
  + serialLogsOn => Serial logs ON/OFF
  + webLogsOn => Web logs ON/OFF
  + Web configuration/visualization support
- Check webserver and restart if needed
  + Init webserver-dependant modules after webserver initialization during normal execution:
    * WebSocket
- Forcing to free up heap memory in the event it's below a thresholds
  + Switch WiFi OFF/ON, WebServer OFF/ON, etc.
- Troubleshooting
  + ISS004: GAS interrupt trigered when THERMOSTAT interrupt is trigered too (and viceversa??). Fixed in 0.9.2
    Fix: it can't be avoided (due to static???), but GAS notificacion is done only if readings taken just right after GAS interrupt show GAS.
  + ISS001: Wrong info in logs from boot time - v0.9.3
    *   [printCurrentWiFi] - Signal strength (RSSI): e memory for RF calibration data => Use WiFi.SSID() instead of wifiNet.RSSI ?
    *   [printCurrentWiFi] - Encryption Type: 3
    *   [printCurrentWiFi] - WiFi Channel: E (%u) %s: %s: store calibration mac failed(0x%x)
  + ISS002: Unexpected reboot
    * Fixed in v0.9.6. Not delete webServer nor webSocket objects
  + ISS003: Preventive reset are too often. RCA - seems to be related to the frequent WiFi disconnections due to the weak WiFi signal
    * Fixed in v0.9.6. Decreased WEBSERVER_MIN_HEAP_SIZE threshold 
  + ISS005: Web server KO after WiFi reconnection
    * Fixed in v0.9.6. Not delete webServer nor webSocket objects
  + ISS006: Side Col height for Graphs, Global Info, Basic Configuration, Console html pages
  + ISS007: HA takes doesn't refresh quickly Heater Status/Icon after IoT restart (ie. firmware upgred)
    * Fixed in v0.9.7 - MQTT HADiscovery packets are sent several times after bootup
  + ISS008: Randomly crash (heap getting off ??)
    * Fixed in v0.9.B. See IS0016 for the fix
  + ISS009: Web server not available randomly (connectivty lost ??)
    * Fixed in v0.9.B. See IS0016 for the fix
  + ISS010: Time On Today counter not saved in Yesterday when passing to the next day
    * Fixed in v0.9.9 - boiler variables were not updated in one_second_check_period function
  + ISS011: No subscripion on MQTT power Topic after enabling MQTT Power Measurements in web
    * Fixed in v0.9.9 - webServer.cpp
  + ISS012: Web server not available randomly and/or connectivy lost if boiler is ON (mqttmessages) and having active SSE clients (index.html)
    * Fixed in v0.9.B. See IS0016 for the fix
  + ISS013: Web server not available randomly and/or connectivy lost if there are both console clientes open and having active SSE clients (index.html)
    * Fixed in v0.9.B. See IS0016 for the fix
  + IS0014: boilerOnToday and boilerOnYesterday not saved correctly in EEPROM when changing day
    * boilerOnYesterday=0, boilerOnToday=88 => change day => boilerOnYesterday=88, boilerOnToday=0 => Reboot ==> boilerOnYesterday=0, boilerOnToday=198
    * Fixed in v0.9.B
  + IS0015: boiler and heater Time On Mounth counters not reset
    * Fixed in v0.9.B
  + IS0016: Some objects in the HA Discovery message are not recognized by HA in the very first packet sent after booting up
    * Fixed in v0.9.B
  + IS0017: New code to send HA Discovery MQTT message to reduce heap size and heap fragmentation
    * Fixed in v0.9.B
    * No String(...).c_str() usage 
    * Split HA Discovery messages into 8 functions
  + ISS018: webLogsOn and sysLogsOn are always OFF (false) when the WiFi is recoverd after losing connectivity 
  + ISS019: Avoid network heavy tasks in terms of heap, RAM, etc. to run concurrently
    * v1.1.3 - Web server test done when uploading binary makes the upload process to fail
      + Added lastTimeWebPageServed variable to track how long ago a web page was served. If recently, no need for connectivity checks
    * v1.1.2 - Actions in the main loop are ignored if webserver is serving content (webServerResponding flag) to avoid risking heap leakage
    * v1.1.2 - avoid serving web pages if other heavy processes are ongoing (mqtt publishing, send http updates) (new blockWebServer variable)
      + Increase Task Watchdog Timeout to ESP_TASK_WDT_TIMEOUT - esp_task_wdt_init(ESP_TASK_WDT_TIMEOUT, true);
  + ISS020 - minMaxHeapBlockSizeSinceUpgrade is not updated after the firmware upgrade
    * v1.1.5 - Fixed in main.cpp
- Remove year from the MQTT topic for both previous and current years - v0.9.9
- Time counters for boiler, similar to the heater ones - v0.9.9
- Show Current Power (and Energy ?) in the index page - v0.9.9
- Deleted references to NTPResuming - v0.9.9
- Color grey Web boiler icon and Energy info if not powerMeasureEnabled - v0.9.9
- Set N/A or N/E to the values related to SmartPlug if powerMeasureEnabled is disabled from web - v0.9.9
- New strategy to create the mqtt HADiscovery message payload different than String to reduce heap consumption - v0.9.B
- New approach based on updating html id tags with javascript for serving dynamic web content
  + graphs and container still with ~ processing
- syslog v1.1.1
- logs switches in both web and mqtt

  Discarded
  -------------
- Load time counters after NTP is synced if it wasn't during bootup.
  + Sum current time counters (if needed) to EEPROM ones and save them in EEPROM.
  ==> It's complex as it might impact today's and yesterday's counters, and different month and years.